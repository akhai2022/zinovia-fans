name: ci

on:
  push:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Prepare env
        run: cp .env.example .env
      - name: Compose up
        run: make up
      - name: Migrate
        run: make migrate
      - name: API lint
        run: make api-lint
      - name: API typecheck
        run: make api-typecheck
      - name: API tests
        run: make api-test
      - name: Web lint
        run: make web-lint
      - name: Web build
        run: make web-build
      - name: Contracts
        run: make gen-contracts
      - name: Verify contracts unchanged
        run: git diff --exit-code
